This is shared code for use with subtrees

this change is from subtree-parakeet
